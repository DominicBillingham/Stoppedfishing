@model AspNetCore.Data.Models.Meeting

<div class="row">

    <div class="col-6">
        <h1 class="fw-bold">1. Choose an awesome username</h1>
        <input type="text" placeholder="John Smith" class="col-9 mb-2" id="UserName" />
        <button id="CreateUserBtn" class="float-end col-3">Continue</button>
    </div>

</div>

<div class="col-6 panel" id="TablePanel">

    <h1 class="fw-bold">2. Click on all the times you are free</h1>

    <div class="d-inline-block text-center">

        <table id="simpleTable">

            <thead id="simpleTableHeader">
                <tr>
                    <th>
                        Monday
                    </th>
                    <th>
                        Tuesday
                    </th>
                    <th>
                        Wednesday
                    </th>
                    <th>
                        Thursday
                    </th>
                    <th>
                        Friday
                    </th>
                    <th>
                        Saturday
                    </th>
                    <th>
                        Sunday
                    </th>
                </tr>
            </thead>

        </table>

        <div class="col-6">

            <button class="d-inline-block" id="JoinMeetingBtn">Add times!</button>

            <form class="d-inline-block" method="post" asp-controller="Meeting" asp-action="JoinMeeting">

                <input type="hidden" name="id" value="@Model.Id" />
                <button class="d-inline-block">Join Meeting!</button>

            </form>


        </div>

    </div>

</div>




@section Scripts {

    <script>

        window.onload = function () {
            CreateTable();
            TableSelector();
        }

        function CreateTable() {

            SimpleBlocks.forEach(function (timeBlock) {
                var row = document.createElement("tr");
                Days.forEach(function (day) {

                    var td = document.createElement("td");
                    td.setAttribute("timeblock", timeBlock.Number);
                    td.setAttribute("day", day.Number);

                    var text = document.createTextNode(timeBlock.Name);
                    td.appendChild(text);

                    row.appendChild(td);

                });

                var table = document.querySelector("#simpleTable");
                table.appendChild(row)
            });

        }

        function TableSelector() {

            $('td').on('mousedown', function mouseState(e) {

                if (e.type == "mousedown") {

                    var td = $(this);

                    if (td.hasClass("selected-block")) {
                        td[0].classList.remove("selected-block");
                    } else {
                        td[0].classList.add("selected-block");
                    }
                }

            });

        }

    </script>

    <script>

        var _userId = null;

        $("#CreateUserBtn").on("click", function () {
            $("#TablePanel").slideDown("slow");
            CreateUser();
        });

        $("#JoinMeetingBtn").on("click", function () {
            UpdateUserBlocks();
        });


        function CreateUser() {

            var userName = $("#UserName").val();

            var data = {
                UserName: userName
            }

            $.ajax({
                type: "POST",
                url: "/User/CreateNewUser",
                dataType: "json",
                data: data,

                success: function (userId) {
                    _userId = userId;
                },

                error: function (response) {
                    alert(response.responseText)
                }

            });
        }

        function UpdateUserBlocks() {

            var table = document.querySelector("#simpleTable");
            var selected = table.getElementsByClassName("selected-block");
            var blocks = [];

            for (item of selected) {

                var timeblock = { "Day": item.getAttribute("day"), "SimpleBlock": item.getAttribute("timeblock") }
                blocks.push(timeblock);
            }

            var data = {
                "userId": _userId,
                "blocks": blocks
            };

            $.ajax({
                type: "POST",
                url: "/User/UpdateUserTimeBlocks",
                dataType: "json",
                data: data,
            }).done(function () {
                //alert("success");
            })
        }

    </script>

}